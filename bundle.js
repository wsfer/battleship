(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var s=e.g.document;if(!t&&s&&(s.currentScript&&(t=s.currentScript.src),!t)){var i=s.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&!t;)t=i[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t=class{static createPage(){return(new Range).createContextualFragment('\n            <header>\n                <button class="reset-button js-reset-game">BATTLESHIP</button>\n                <button class="svg-button sound-button js-sound on">\n                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n                        <title>Sound on</title>\n                        <path d="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z" />\n                    </svg>\n                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n                        <title>Sound off</title>\n                        <path d="M12,4L9.91,6.09L12,8.18M4.27,3L3,4.27L7.73,9H3V15H7L12,20V13.27L16.25,17.53C15.58,18.04 14.83,18.46 14,18.7V20.77C15.38,20.45 16.63,19.82 17.68,18.96L19.73,21L21,19.73L12,10.73M19,12C19,12.94 18.8,13.82 18.46,14.64L19.97,16.15C20.62,14.91 21,13.5 21,12C21,7.72 18,4.14 14,3.23V5.29C16.89,6.15 19,8.83 19,12M16.5,12C16.5,10.23 15.5,8.71 14,7.97V10.18L16.45,12.63C16.5,12.43 16.5,12.21 16.5,12Z" />\n                    </svg>\n                </button>\n            </header>\n            <main>\n                \n            </main>\n            <footer>\n                <p class="footer-text">Created by <a src="https://github.com/wsfer">@wsfer</a></p>\n                <section class="footer-links">\n                    <a href="#" target="_blank">\n                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n                            <title>Linkedin</title>\n                            <path d="M19 3A2 2 0 0 1 21 5V19A2 2 0 0 1 19 21H5A2 2 0 0 1 3 19V5A2 2 0 0 1 5 3H19M18.5 18.5V13.2A3.26 3.26 0 0 0 15.24 9.94C14.39 9.94 13.4 10.46 12.92 11.24V10.13H10.13V18.5H12.92V13.57C12.92 12.8 13.54 12.17 14.31 12.17A1.4 1.4 0 0 1 15.71 13.57V18.5H18.5M6.88 8.56A1.68 1.68 0 0 0 8.56 6.88C8.56 5.95 7.81 5.19 6.88 5.19A1.69 1.69 0 0 0 5.19 6.88C5.19 7.81 5.95 8.56 6.88 8.56M8.27 18.5V10.13H5.5V18.5H8.27Z" />\n                        </svg>\n                    </a>\n                    <a href="https://github.com/wsfer" target="_blank">\n                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n                            <title>Github</title>\n                            <path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z" />\n                        </svg>\n                    </a>\n                </section>\n            </footer>\n        ')}static createStartScreen(){return(new Range).createContextualFragment('\n            <h1 class="game-title">BATTLESHIP<h1>\n            <button class="text-button js-new-game">New Game</button>\n            <section class="popup-box js-sound-box">\n                <p>Allow sound?</p>\n                <div>\n                    <button class="solid-button js-allow-sound">Allow</button>\n                    <button class="solid-button js-refuse-sound">Refuse</button>\n                </div>\n            </section>\n        ')}static createFleetScreen(){let e="";for(let t=0;t<100;t++)e+=`<div class="square js-square" data-x="${Math.floor(t/10)}" data-y="${t%10}"></div>`;return(new Range).createContextualFragment(`\n            <div class="player-name-input">\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n                    <title>Drawing Pen</title>\n                    <path d="M9.75 20.85C11.53 20.15 11.14 18.22 10.24 17C9.35 15.75 8.12 14.89 6.88 14.06C6 13.5 5.19 12.8 4.54 12C4.26 11.67 3.69 11.06 4.27 10.94C4.86 10.82 5.88 11.4 6.4 11.62C7.31 12 8.21 12.44 9.05 12.96L10.06 11.26C8.5 10.23 6.5 9.32 4.64 9.05C3.58 8.89 2.46 9.11 2.1 10.26C1.78 11.25 2.29 12.25 2.87 13.03C4.24 14.86 6.37 15.74 7.96 17.32C8.3 17.65 8.71 18.04 8.91 18.5C9.12 18.94 9.07 18.97 8.6 18.97C7.36 18.97 5.81 18 4.8 17.36L3.79 19.06C5.32 20 7.88 21.47 9.75 20.85M18.96 7.33L13.29 13H11V10.71L16.67 5.03L18.96 7.33M22.36 6.55C22.35 6.85 22.04 7.16 21.72 7.47L19.2 10L18.33 9.13L20.93 6.54L20.34 5.95L19.67 6.62L17.38 4.33L19.53 2.18C19.77 1.94 20.16 1.94 20.39 2.18L21.82 3.61C22.06 3.83 22.06 4.23 21.82 4.47C21.61 4.68 21.41 4.88 21.41 5.08C21.39 5.28 21.59 5.5 21.79 5.67C22.08 5.97 22.37 6.25 22.36 6.55Z" />\n                </svg>\n                <label for="name">Your name:</label>\n                <input id="name" class="js-player-name" type="text" maxlength="12" value="PlayerOne" required>\n                <p class="invalid-input-message">Name is required</p>\n            </div>\n            <h2>Build your fleet</h2>\n            <p>\n                <span class="js-selected-ship">No ship</span> selected\n            </p>\n            <section class="fleet-builder">\n                <div class="fleet-container">\n                    <section class="settings">\n                        <button class="svg-button js-random-fleet">\n                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n                                <title>Random fleet</title>\n                                <path d="M5,3H19A2,2 0 0,1 21,5V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V5A2,2 0 0,1 5,3M7,5A2,2 0 0,0 5,7A2,2 0 0,0 7,9A2,2 0 0,0 9,7A2,2 0 0,0 7,5M17,15A2,2 0 0,0 15,17A2,2 0 0,0 17,19A2,2 0 0,0 19,17A2,2 0 0,0 17,15M17,5A2,2 0 0,0 15,7A2,2 0 0,0 17,9A2,2 0 0,0 19,7A2,2 0 0,0 17,5M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M7,15A2,2 0 0,0 5,17A2,2 0 0,0 7,19A2,2 0 0,0 9,17A2,2 0 0,0 7,15Z" />\n                            </svg>\n                        </button>\n                        <button class="svg-button js-rotate-ship" disabled>\n                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n                                <title>Rotate Ship</title>\n                                <path d="M12 7C6.5 7 2 9.2 2 12C2 14.2 4.9 16.1 9 16.8V20L13 16L9 12V14.7C5.8 14.1 4 12.8 4 12C4 10.9 7 9 12 9S20 10.9 20 12C20 12.7 18.5 13.9 16 14.5V16.6C19.5 15.8 22 14.1 22 12C22 9.2 17.5 7 12 7Z" />\n                            </svg>\n                        </button>\n                        <button class="svg-button js-unselect-ship" disabled>\n                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n                                <title>Unselect</title>\n                                <path d="M12 2C17.5 2 22 6.5 22 12S17.5 22 12 22 2 17.5 2 12 6.5 2 12 2M12 4C10.1 4 8.4 4.6 7.1 5.7L18.3 16.9C19.3 15.5 20 13.8 20 12C20 7.6 16.4 4 12 4M16.9 18.3L5.7 7.1C4.6 8.4 4 10.1 4 12C4 16.4 7.6 20 12 20C13.9 20 15.6 19.4 16.9 18.3Z" />\n                            </svg>\n                        </button>\n                    </section>\n                    <section class="gameboard">\n                        <div class="x-coords">\n                            <div>A</div>\n                            <div>B</div>\n                            <div>C</div>\n                            <div>D</div>\n                            <div>E</div>\n                            <div>F</div>\n                            <div>G</div>\n                            <div>H</div>\n                            <div>I</div>\n                            <div>J</div>\n                        </div>\n                        <div class="y-coords">\n                            <div>1</div>\n                            <div>2</div>\n                            <div>3</div>\n                            <div>4</div>\n                            <div>5</div>\n                            <div>6</div>\n                            <div>7</div>\n                            <div>8</div>\n                            <div>9</div>\n                            <div>10</div>\n                        </div>\n                        <div class="fleet js-fleet">\n                            ${e}\n                        </div>\n                    </section>\n                <section class="ship-dock js-ship-dock">\n                    <div id="destroyer" class="destroyer ship js-ship" draggable="true"\n                        data-direction="horizontal" data-name="destroyer"\n                        style="height: clamp(1rem, 5vw, 2.5rem); width: clamp(2rem, 10vw, 5rem);">\n                    </div>\n                    <div id="submarine" class="submarine ship js-ship" draggable="true"\n                        data-direction="horizontal" data-name="submarine"\n                        style="height: clamp(1rem, 5vw, 2.5rem); width: clamp(3rem, 15vw, 7.5rem);">\n                    </div>\n                    <div id="cruiser" class="cruiser ship js-ship" draggable="true"\n                        data-direction="horizontal" data-name="cruiser"\n                        style="height: clamp(1rem, 5vw, 2.5rem); width: clamp(3rem, 15vw, 7.5rem);">\n                    </div>\n                    <div id="battleship" class="battleship ship js-ship" draggable="true"\n                        data-direction="horizontal" data-name="battleship"\n                        style="height: clamp(1rem, 5vw, 2.5rem); width: clamp(4rem, 20vw, 10rem);">\n                    </div>\n                    <div id="carrier" class="carrier ship js-ship" draggable="true"\n                        data-direction="horizontal" data-name="carrier"\n                        style="height: clamp(1rem, 5vw, 2.5rem); width: clamp(5rem, 25vw, 12.5rem);">\n                    </div>\n                </section>\n            </section>\n            <button class="solid-button js-start-game" disabled>Start Game</button>\n        `)}static createGameScreen(){let e="";for(let t=0;t<100;t++)e+=`<div class="square js-square" data-x="${Math.floor(t/10)}" data-y="${t%10}"></div>`;return(new Range).createContextualFragment(`\n            <p>\n                <span class="js-player-name-turn action-text"></span> turn\n            </p>\n            <section class="player-boards-container">\n                <section class="board-container">\n                    <section class="fleet-status player-one">\n                        <div class="ship-health destroyer js-player-destroyer"></div>\n                        <div class="ship-health submarine js-player-submarine"></div>\n                        <div class="ship-health cruiser js-player-cruiser"></div>\n                        <div class="ship-health battleship js-player-battleship"></div>\n                        <div class="ship-health carrier js-player-carrier"></div>\n                    </section>\n                    <div class="fleet-container">\n                        <h3 class="board-title"><span class="js-player-name-board"></span> fleet</h3>\n                        <section class="gameboard">\n                            <div class="x-coords">\n                                <div>A</div>\n                                <div>B</div>\n                                <div>C</div>\n                                <div>D</div>\n                                <div>E</div>\n                                <div>F</div>\n                                <div>G</div>\n                                <div>H</div>\n                                <div>I</div>\n                                <div>J</div>\n                            </div>\n                            <div class="y-coords">\n                                <div>1</div>\n                                <div>2</div>\n                                <div>3</div>\n                                <div>4</div>\n                                <div>5</div>\n                                <div>6</div>\n                                <div>7</div>\n                                <div>8</div>\n                                <div>9</div>\n                                <div>10</div>\n                            </div>\n                            <div class="fleet js-player-fleet disabled">\n                                ${e}\n                            </div>\n                        </section>\n                    </div>\n                </section>\n                <section class="board-container">\n                    <div class="fleet-container">\n                        <h3 class="board-title"><span>Computer</span> fleet</h3>\n                        <section class="gameboard">\n                            <div class="x-coords">\n                                <div>A</div>\n                                <div>B</div>\n                                <div>C</div>\n                                <div>D</div>\n                                <div>E</div>\n                                <div>F</div>\n                                <div>G</div>\n                                <div>H</div>\n                                <div>I</div>\n                                <div>J</div>\n                            </div>\n                            <div class="y-coords">\n                                <div>1</div>\n                                <div>2</div>\n                                <div>3</div>\n                                <div>4</div>\n                                <div>5</div>\n                                <div>6</div>\n                                <div>7</div>\n                                <div>8</div>\n                                <div>9</div>\n                                <div>10</div>\n                            </div>\n                            <div class="fleet js-computer-fleet">\n                                ${e}\n                            </div>\n                        </section>\n                    </div>\n                    <section class="fleet-status player-two">\n                        <div class="ship-health destroyer js-computer-destroyer"></div>\n                        <div class="ship-health submarine js-computer-submarine"></div>\n                        <div class="ship-health cruiser js-computer-cruiser"></div>\n                        <div class="ship-health battleship js-computer-battleship"></div>\n                        <div class="ship-health carrier js-computer-carrier"></div>\n                    </section>\n                </section>\n            </section>\n            <p class="action-text js-combat-log">Attack!</p>\n            <section class="popup-box js-gameover-box">\n                <h3><span class="action-text js-winner"></span> won the game</h3>\n                <button class="solid-button js-restart-game">Play again</button>\n            </section>\n        `)}},s=class{static addFleetScreenEvents(e,t){let s=null;const i=e.querySelector(".js-selected-ship"),n=e.querySelectorAll(".js-ship"),a=e.querySelectorAll(".js-square"),r=e.querySelector(".js-rotate-ship"),o=e.querySelector(".js-unselect-ship"),l=e.querySelector(".js-start-game"),d=e.querySelector(".js-player-name");d.addEventListener("input",(e=>{""===e.target.value?l.disabled=!0:t.isDone()&&(l.disabled=!1)})),e.querySelector(".js-random-fleet").addEventListener("click",(()=>{t.generateRandomFleet().forEach((e=>{const t=document.getElementById(e.target),[s,i]=e.newPositions[0];a[10*s+i].appendChild(t),t.dataset.direction!==e.direction&&(t.dataset.direction=e.direction,[t.style.width,t.style.height]=[t.style.height,t.style.width])})),""!==d.value&&(l.disabled=!1)})),r.addEventListener("click",(()=>{if(null!==s){const e=t.changeDirection(s.dataset.name);s.dataset.direction="horizontal"===s.dataset.direction?"vertical":"horizontal",[s.style.width,s.style.height]=[s.style.height,s.style.width],e.isValid||(document.querySelector(".js-ship-dock").appendChild(s),l.disabled=!0)}})),o.addEventListener("click",(e=>{null!==s&&(s.classList.toggle("selected"),s=null,i.classList.remove("action-text"),i.textContent="No ship",e.target.classList.toggle("disabled"),r.disabled=!0,o.disabled=!0)})),n.forEach((e=>{e.addEventListener("click",(e=>{s!==e.target&&(null!==s?s.classList.toggle("selected"):(r.disabled=!1,o.disabled=!1),s=e.target,e.target.classList.toggle("selected"),i.textContent=e.target.dataset.name.charAt(0).toUpperCase()+e.target.dataset.name.slice(1),i.classList.add("action-text"),document.querySelector(".js-unselect-ship").classList.toggle("disabled"),r.disabled=!1,o.disabled=!1)})),e.addEventListener("dragstart",(e=>{e.dataTransfer.setData("ship",e.target.id),s!==e.target&&(null!==s?s.classList.toggle("selected"):(r.disabled=!1,o.disabled=!1),s=e.target,e.target.classList.toggle("selected"),i.textContent=e.target.dataset.name.charAt(0).toUpperCase()+e.target.dataset.name.slice(1),i.classList.add("action-text"),document.querySelector(".js-unselect-ship").classList.toggle("disabled"))}))})),e.querySelector(".js-fleet").addEventListener("dragover",(e=>{e.preventDefault(),e.target.classList.contains(".js-square")&&e.target.classList.add("selected")})),e.querySelector(".js-fleet").addEventListener("dragleave",(e=>{e.target.classList.contains(".js-square")&&e.target.classList.remove("selected")})),e.querySelector(".js-fleet").addEventListener("drop",(e=>{if(e.preventDefault(),e.target.classList.contains("js-square")){e.target.classList.remove("selected");const s=e.dataTransfer.getData("ship"),i=document.getElementById(s),[n,a]=[Number(e.target.dataset.x),Number(e.target.dataset.y)];t.move(s,[n,a]).isValid&&(e.target.appendChild(i),t.isDone()&&""!==d.value&&(l.disabled=!1))}}))}static addGameScreenEvents(e,t,s){const i=e.querySelector(".js-combat-log"),n=e.querySelector(".js-player-name-turn"),a=e.querySelector(".js-computer-fleet"),r=e.querySelector(".js-player-fleet"),o=e.querySelectorAll(".js-player-fleet > .js-square"),l=e.querySelector(".js-winner");a.addEventListener("click",(async e=>{if(e.target.classList.contains("js-square")&&!a.classList.contains("disabled")){a.classList.toggle("disabled"),r.classList.toggle("disabled");const[d,c]=[Number(e.target.dataset.x),Number(e.target.dataset.y)],h=await t.play([d,c]);if(i.textContent=`${h.attacker} attacked ${h.defender}'s ${h.target}`,n.textContent=h.defender,h.isShip?(e.target.classList.add("sunken"),document.querySelector(`.js-computer-${h.target.toLowerCase()}`).style.backgroundImage=`linear-gradient(to left, var(--secondary) 0 ${Math.round(h.health/h.size*100)}%, var(--light-opaque) ${Math.round(h.health/h.size*100)}% 100%)`,s.playExplosion()):(e.target.classList.add("water"),s.playSplash()),h.gameover)return document.body.classList.toggle("popup"),void(l.textContent=h.attacker);const u=await t.play(null);if(i.textContent=`${u.attacker} attacked ${u.defender}'s ${u.target}`,n.textContent=u.defender,u.isShip?(o[10*u.x+u.y].classList.add("sunken"),document.querySelector(`.js-player-${u.target.toLowerCase()}`).style.backgroundImage=`linear-gradient(to right, var(--secondary) 0 ${Math.round(u.health/u.size*100)}%, var(--light-opaque) ${Math.round(u.health/u.size*100)}% 100%)`,s.playExplosion()):(o[10*u.x+u.y].classList.add("water"),s.playSplash()),u.gameover)return document.body.classList.toggle("popup"),void(l.textContent=u.attacker);a.classList.toggle("disabled"),r.classList.toggle("disabled")}}))}},i=class{#e;#t;#s;constructor(){this.#e=new Map([["destroyer",{name:"destroyer",size:2,direction:"horizontal",positions:null}],["submarine",{name:"submarine",size:3,direction:"horizontal",positions:null}],["cruiser",{name:"cruiser",size:3,direction:"horizontal",positions:null}],["battleship",{name:"battleship",size:4,direction:"horizontal",positions:null}],["carrier",{name:"carrier",size:5,direction:"horizontal",positions:null}]]),this.#t=Array(10).fill().map((()=>Array(10).fill("water"))),this.#s=Array(10).fill().map((()=>Array(10).fill(!0)))}#i(e){e.positions.main.forEach((([t,s])=>{this.#t[t][s]=e.name,this.#s[t][s]=!1})),e.positions.border.forEach((([e,t])=>this.#s[e][t]=!1))}#n(e){e.positions.main.forEach((([e,t])=>{this.#t[e][t]="water",this.#s[e][t]=!0})),e.positions.border.forEach((([e,t])=>{this.#a([e,t])||(this.#s[e][t]=!0)}))}#a([e,t]){const s=[[e-1,t-1],[e-1,t],[e-1,t+1],[e,t-1],[e,t+1],[e+1,t-1],[e+1,t],[e+1,t+1]].filter((([e,t])=>e>=0&&e<10&&t>=0&&t<10));for(const[e,t]of s)if("water"!==this.#t[e][t])return!0;return!1}#r(e,[t,s]){const i=Array(e.size).fill().map(((i,n)=>"horizontal"===e.direction?[t,s+n]:[t+n,s])),n=[],a=[];for(let e=i[0][0]-1;e<=i[i.length-1][0]+1;e++)n.push(e);for(let e=i[0][1]-1;e<=i[i.length-1][1]+1;e++)a.push(e);const r=n.flatMap((e=>a.map((t=>[e,t])))).filter((([e,t])=>e>=0&&e<10&&t>=0&&t<10&&!i.map((([s,i])=>s===e&&i===t)).includes(!0)));return{main:i,border:r}}#o(e){for(const[t,s]of e)if(t<0||t>9||s<0||s>9||!this.#s[t][s])return!1;return!0}changeDirection(e){const t=this.#e.get(e);if(t.direction="horizontal"===t.direction?"vertical":"horizontal",t.positions){this.#n(t);const e=this.#r(t,t.positions.main[0]),s=this.#o(e.main);return s?(t.positions=e,this.#i(t)):t.positions=null,{isValid:s,target:t.name,size:t.size,direction:t.direction,newPositions:s?e.main:null}}return{isValid:!0,target:t.name,size:t.size,direction:t.direction,newPositions:null}}move(e,t){const s=this.#e.get(e);s.positions&&this.#n(s);const i=this.#r(s,t),n=this.#o(i.main);return s.positions=n?i:s.positions,s.positions&&this.#i(s),{isValid:n,target:s.name,size:s.size,direction:s.direction,newPositions:n?i.main:null}}generateRandomFleet(){this.#t=Array(10).fill().map((()=>Array(10).fill("water"))),this.#s=Array(10).fill().map((()=>Array(10).fill(!0))),[...this.#e.values()].forEach((e=>{e.positions=null}));const e=[...this.#e.keys()],t=[];for(;e.length>0;){const s=e.pop(),i=this.#s.map(((e,t)=>e.map(((e,s)=>!!e&&[t,s])))).filter((e=>e.filter((e=>e)).length>0)),n=i[Math.floor(Math.random()*i.length)].filter((e=>e)),a=n[Math.floor(Math.random()*n.length)];this.#e.get(s).direction=["horizontal","vertical"][Math.floor(2*Math.random())];const r=this.move(s,a);r.isValid?t.push(r):e.push(s)}return t}isDone(){const e=[...this.#e.values()],t=e.filter((e=>null!==e.positions));return t.length===e.length}getFleet(){return this.#t.map((e=>e.slice()))}},n=class{#l;#d;#c;constructor(e,t){this.#l=e,this.#d=e,this.#c=t}get size(){return this.#l}get health(){return this.#d}get name(){return this.#c}hit(){return this.#d>0&&(this.#d-=1),{target:this.#c,size:this.#l,health:this.#d}}isSunk(){return 0===this.#d}},a=class{#h;#t;constructor(e){this.#h=new Map([["destroyer",new n(2,"Destroyer")],["submarine",new n(3,"Submarine")],["cruiser",new n(3,"Cruiser")],["battleship",new n(4,"Battleship")],["carrier",new n(5,"Carrier")],["water",new n(0,"Water")],["sunken",new n(0,"Sunken ship")]]),this.#t=e.map((e=>e.map((e=>this.#h.get(e)))))}receiveAttack([e,t]){const s=this.#t[e][t],i=s.hit();return s.size>0?(this.#t[e][t]=this.#h.get("sunken"),{...i,x:e,y:t,isShip:!0,gameover:!!s.isSunk()&&this.#u()}):{target:i.target,x:e,y:t,isShip:!1,gameover:!1}}#u(){const e=[...this.#h.values()],t=e.filter((e=>e.isSunk()));return t.length===e.length}getFleet(){return this.#t.map((e=>e.map((e=>e.name))))}},r=class{#c;#p;#v;constructor(e,t){this.#c=e,this.#p=t,this.#v=!1}get name(){return this.#c}get isComputer(){return this.#v}receiveAttack([e,t]){return this.#p.receiveAttack([e,t])}async attack(e,t){return e.receiveAttack(t)}},o=class extends r{#v;#m;#g;#y;constructor(e,t,s){super(e,t),this.#v=!0,this.#g=Array(10).fill().map(((e,t)=>Array(10).fill().map(((e,s)=>[t,s])))),this.#y=null,this.#m=s}async attack(e){const t=await this.#m.generateMove(this.#g,this.#y),s=e.receiveAttack(t);if(this.#g[s.x][s.y]=null,s.isShip)if(null===this.#y)this.#y={direction:null,positions:[[s.x,s.y]]};else if(this.#y.positions.length+1===s.size)this.#y=null;else{const[e]=this.#y.positions[0];this.#y.positions.push([s.x,s.y]),this.#y.direction=s.x===e?"horizontal":"vertical"}return s}},l=class{static async generateMove(e,t){if(null===t)return await new Promise((e=>{setTimeout(e,1e3*Math.random()+1e3)})),this.#f(e);if(1===t.positions.length){const s=t.positions[0];return await new Promise((e=>{setTimeout(e,1e3*Math.random()+1e3)})),this.#b(e,s)}return await new Promise((e=>{setTimeout(e,1e3*Math.random()+1e3)})),this.#w(e,t.direction,t.positions)}static#f(e){const t=e.filter((e=>e.filter((e=>e)).length>0)),s=t[Math.floor(Math.random()*t.length)].filter((e=>null!==e));return s[Math.floor(Math.random()*s.length)]}static#b(e,[t,s]){const i=[[t+1,s],[t,s-1],[t,s+1],[t-1,s]].filter((([t,s])=>t>=0&&t<10&&s>=0&&s<10&&null!==e[t][s]));return i[Math.floor(Math.random()*i.length)]}static#w(e,t,s){let i;if("horizontal"===t){const t=s[0][0],n=s.map((([e,t])=>t));i=[[t,Math.min(...n)-1],[t,Math.max(...n)+1]].filter((([t,s])=>s>=0&&s<10&&null!==e[t][s]))}if("vertical"===t){const t=s[0][1],n=s.map((([e,t])=>e));i=[[Math.min(...n)-1,t],[Math.max(...n)+1,t]].filter((([t,s])=>t>=0&&t<10&&null!==e[t][s]))}return i[Math.floor(Math.random()*i.length)]}},d=new class{#C;#S;#j;constructor(e,t,s){this.#C=new Audio(e),this.#S=new Audio(t),this.#j=new Audio(s),this.#C.autoplay=!0,this.#C.loop=!0}toggle(){return this.#C.muted=!this.#C.muted,this.#C.muted}async playMusic(){return this.#C.play()}async playExplosion(){this.#C.muted||this.#S.play()}async playSplash(){this.#C.muted||this.#j.play()}}(e.p+"2fc907728fd185de0a31.mp3",e.p+"4dff150e73adf62cc2d3.mp3",e.p+"de67f6401b67e5c5c2d5.mp3"),c=function(){document.querySelector(".js-reset-game").style.display="none";const e=t.createStartScreen(),n=t.createFleetScreen(),h=t.createGameScreen(),u=new i,p=new i;let v=null,m=null,g=null,y=null,f=null;e.querySelector(".js-new-game").addEventListener("click",(()=>{document.querySelector("main").textContent="",document.querySelector(".js-reset-game").style.display="block",p.generateRandomFleet(),m=new a(p.getFleet()),y=new o("Computer",m,l),s.addFleetScreenEvents(n,u),document.querySelector("main").appendChild(n)})),n.querySelector(".js-start-game").addEventListener("click",(()=>{const e=document.querySelector(".js-player-name");u.isDone()&&""!==e.value&&(document.querySelector("main").textContent="",v=new a(u.getFleet()),g=new r(e.value,v),f=new class{#L;constructor(e,t){this.#L=[t,e]}get nextPlayer(){return this.#L[1]}async play(e){const t=this.#L.pop(),s=this.#L.pop(),i=await t.attack(s,e);return this.#L.push(t,s),{attacker:t.name,defender:s.name,...i}}}(g,y),s.addGameScreenEvents(h,f,d),h.querySelector(".js-player-name-turn").textContent=g.name,h.querySelector(".js-player-name-board").textContent=g.name,document.querySelector("main").appendChild(h))})),h.querySelector(".js-restart-game").addEventListener("click",(()=>{document.body.classList.toggle("popup"),c()})),document.querySelector("main").textContent="",document.querySelector("main").appendChild(e)},h=t.createPage(d);h.querySelector(".js-reset-game").addEventListener("click",c),h.querySelector(".js-sound").addEventListener("click",(()=>{document.querySelector(".js-sound").classList.toggle("on"),d.toggle()||d.playMusic()})),document.body.appendChild(h),c(),d.playMusic().catch((()=>{document.body.classList.toggle("popup"),document.querySelector(".js-allow-sound").addEventListener("click",(()=>{document.body.classList.toggle("popup"),d.playMusic()})),document.querySelector(".js-refuse-sound").addEventListener("click",(()=>{document.body.classList.toggle("popup"),document.querySelector(".js-sound").classList.toggle("on"),d.toggle()}))}))})();